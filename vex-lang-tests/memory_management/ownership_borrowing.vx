// Test file for Vex memory management: Ownership and Borrowing
// This file tests ownership transfer and borrowing rules

struct Point {
    x: i32,
    y: i32,
}

fn take_ownership(p: Point) {
    // p is now owned here
    let x = p.x;
}

fn borrow_immutable(p: &Point) {
    let x = p.x;  // Can read
    // p.x = 10;  // Cannot modify through immutable borrow
}

fn borrow_mutable(p: &Point!) {
    p.x = 10;  // Can modify through mutable borrow
    p.y = 20;
}

fn main(): i32 {
    let p1 = Point { x: 10, y: 20 };
    let x1 = p1.x;  // OK

    // take_ownership(p1);  // Ownership moves, p1 no longer valid
    // let x2 = p1.x;  // ERROR: p1 moved

    let p2 = Point { x: 5, y: 15 };
    borrow_immutable(&p2);  // Immutable borrow
    let x3 = p2.x;  // OK, borrow ended

    let! p3 = Point { x: 1, y: 2 };
    borrow_mutable(&p3);  // Mutable borrow
    let x4 = p3.x;  // OK, borrow ended

    return x1 + x3 + x4;
}