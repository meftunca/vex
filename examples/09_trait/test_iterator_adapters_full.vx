// Test Iterator Adapters: map, filter, take, skip
// Demonstrates functional-style iteration with chaining

import { Iterator } from "core";

// Simple counter iterator for testing
struct Counter impl Iterator {
    type Item = i32;
    current: i32,
    max: i32,
    
    fn next()!: Option<i32> {
        if self.current >= self.max {
            return None;
        }
        
        let val = self.current;
        self.current = self.current + 1;
        return Some(val);
    }
}

fn main(): i32 {
    println("=== Testing Iterator Adapters ===\n");
    
    // Test 1: map() - double each number
    println("Test 1: map(x => x * 2)");
    let! counter1 = Counter { current: 0, max: 5 };
    let! doubled = counter1.map(|x| x * 2);
    
    for val in doubled {
        print("  ");
        println(val);  // Should print: 0, 2, 4, 6, 8
    }
    
    // Test 2: filter() - only even numbers
    println("\nTest 2: filter(x => x % 2 == 0)");
    let! counter2 = Counter { current: 0, max: 10 };
    let! evens = counter2.filter(|x| x % 2 == 0);
    
    for val in evens {
        print("  ");
        println(val);  // Should print: 0, 2, 4, 6, 8
    }
    
    // Test 3: take() - first 3 elements
    println("\nTest 3: take(3)");
    let! counter3 = Counter { current: 0, max: 10 };
    let! first_three = counter3.take(3);
    
    for val in first_three {
        print("  ");
        println(val);  // Should print: 0, 1, 2
    }
    
    // Test 4: skip() - skip first 5 elements
    println("\nTest 4: skip(5)");
    let! counter4 = Counter { current: 0, max: 10 };
    let! after_skip = counter4.skip(5);
    
    for val in after_skip {
        print("  ");
        println(val);  // Should print: 5, 6, 7, 8, 9
    }
    
    // Test 5: Chaining - map().filter().take()
    println("\nTest 5: Chaining map().filter().take(3)");
    let! counter5 = Counter { current: 0, max: 10 };
    let! chained = counter5
        .map(|x| x * 2)      // 0, 2, 4, 6, 8, 10, 12, 14, 16, 18
        .filter(|x| x > 5)   // 6, 8, 10, 12, 14, 16, 18
        .take(3);            // 6, 8, 10
    
    for val in chained {
        print("  ");
        println(val);  // Should print: 6, 8, 10
    }
    
    println("\nâœ… All iterator adapter tests completed!");
    return 0;
}
