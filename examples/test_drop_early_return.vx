// Test Drop contract - Early return cleanup
// Drop should be called even on early return

import { Drop } from "core";

extern "C" {
    fn vex_i32_to_string(value: i32): str;
}

struct Resource impl Drop {
    id: i32,
    
    fn drop() {
        print("Dropping resource ");
        print(vex_i32_to_string(self.id));
        println("");
    }
}

fn early_return(should_return: bool): i32 {
    let r1 = Resource { id: 100 };
    
    if should_return {
        let r2 = Resource { id: 200 };
        // r2 and r1 should both be dropped here before return
        return 42;
    }
    
    let r3 = Resource { id: 300 };
    // r3 and r1 should be dropped here
    return 0;
}

fn main(): i32 {
    println("Test 1: Early return");
    let result = early_return(true);
    println("");
    
    println("Test 2: Normal path");
    let result2 = early_return(false);
    println("");
    
    return 0;
}

// Expected output:
// Test 1: Early return
// Dropping resource 200
// Dropping resource 100
// 
// Test 2: Normal path
// Dropping resource 300
// Dropping resource 100
