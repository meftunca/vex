// Layer 1: Defer - Resource Cleanup
// Tests defer statement for cleanup guarantees

fn cleanup(): i32 {
    return 100;
}

fn main(): i32 {
    // Test 1: Simple defer
    defer cleanup();
    
    let! result = 0;
    
    // Test 2: Defer with variable
    let x = 10;
    defer result = result + x;
    
    // Test 3: Multiple defers (LIFO order)
    defer result = result + 1;
    defer result = result + 2;
    
    result = 5;
    
    // Execution order:
    // result = 5
    // defer result = result + 2  : result = 7
    // defer result = result + 1  : result = 8
    // defer result = result + x  : result = 18
    // defer cleanup(): returns 100 but doesn't affect result
    
    return result;  // Should be 18
}
