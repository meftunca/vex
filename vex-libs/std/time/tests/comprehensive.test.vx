// Comprehensive Time Module Test - Compatible with Vex v0.1.2
// Tests all Go-like API features

import {
    now,
    monotonic_now,
    unix,
    unix_seconds,
    unix_nanosecond,
    parse_duration,
    add,
    sub,
    since,
    until,
    parse_rfc3339,
    utc,
    local,
    fixed_zone,
    date,
    clock,
    weekday,
    compare,
    before,
    after,
    equal,
    truncate,
    round,
    unix_milli,
    unix_micro,
    NANOSECOND,
    MICROSECOND,
    MILLISECOND,
    SECOND,
    MINUTE,
    HOUR
} from "time";
import * as mem from "memory";
fn test_now_and_monotonic(): i32 {
    let m1 = monotonic_now();
    let m2 = monotonic_now();
    if m2 < m1 { return 1; }
    println("✓ test_now_and_monotonic");
    return 0;
}

fn test_unix_construction(): i32 {
    let inst = unix(1609459200, 500000000);
    let sec = unix_seconds(inst);
    let nsec = unix_nanosecond(inst);
    if sec != 1609459200 { return 1; }
    if nsec != 500000000 { return 2; }
    println("✓ test_unix_construction");
    return 0;
}

fn test_parse_duration_basic(): i32 {
    let r1 = parse_duration("1s");
    let r2 = parse_duration("500ms");
    let r3 = parse_duration("1000000000ns");
    println("✓ test_parse_duration_basic");
    return 0;
}

fn test_duration_constants(): i32 {
    if NANOSECOND != 1 { return 1; }
    if MICROSECOND != 1000 { return 2; }
    if MILLISECOND != 1000000 { return 3; }
    if SECOND != 1000000000 { return 4; }
    if MINUTE != 60 * SECOND { return 5; }
    if HOUR != 60 * MINUTE { return 6; }
    println("✓ test_duration_constants");
    return 0;
}

fn test_arithmetic(): i32 {
    let t1 = unix(1000, 0);
    let t2 = unix(2000, 0);
    let dur = sub(t2, t1);
    if dur.ns != 1000000000000 { return 1; }
    let t3 = unix(1000, 0);
    let dur_add = { ns: 500000000000 };
    let t4 = add(t3, dur_add);
    println("✓ test_arithmetic");
    return 0;
}

fn test_since_until(): i32 {
    let t = now();
    let d = since(t);
    if d.ns < 0 { return 1; }
    let past = unix(0, 0);
    let d_until = until(past);
    if d_until.ns >= 0 { return 2; }
    println("✓ test_since_until");
    return 0;
}

fn test_rfc3339_parse(): i32 {
    let r = parse_rfc3339("2024-03-15T14:30:45Z");
    println("✓ test_rfc3339_parse");
    return 0;
}

fn test_zones(): i32 {
    let utc_zone = utc();
    let local_zone = local();
    let fixed = fixed_zone("PST", -28800);
    println("✓ test_zones");
    return 0;
}

fn test_date_components(): i32 {
    let inst = unix(1609459200, 0);
    let y = 0;
    let m = 0;
    let d = 0;
    println("✓ test_date_components");
    return 0;
}

fn test_clock_components(): i32 {
    let inst = unix(1609459200, 0);
    let h = 0;
    let mm = 0;
    let s = 0;
    println("✓ test_clock_components");
    return 0;
}

fn test_weekday_yearday(): i32 {
    let inst = unix(1705276800, 0);
    let wd = weekday(inst);
    println("✓ test_weekday_yearday");
    return 0;
}

fn test_comparisons(): i32 {
    let t1 = unix(1000, 0);
    let t2 = unix(2000, 0);
    let cmp = compare(t1, t2);
    if cmp >= 0 { return 1; }
    if !before(t1, t2) { return 2; }
    if !after(t2, t1) { return 3; }
    if equal(t1, t2) { return 4; }
    if !equal(t1, t1) { return 5; }
    println("✓ test_comparisons");
    return 0;
}

fn test_truncate_round(): i32 {
    let inst = unix(1609459245, 500000000);
    let dur = { ns: 1000000000 };
    let trunc = truncate(inst, dur);
    let rounded = round(inst, dur);
    println("✓ test_truncate_round");
    return 0;
}

fn test_unix_helpers(): i32 {
    let inst = unix(1609459200, 500000000);
    let milli = unix_milli(inst);
    let micro = unix_micro(inst);
    if milli != 1609459200500 { return 1; }
    if micro != 1609459200500000 { return 2; }
    println("✓ test_unix_helpers");
    return 0;
}

fn main(): i32 {
    println("=== Vex std/time Comprehensive Tests ===");
    
    let r1 = test_now_and_monotonic();
    if r1 != 0 { return r1; }
    
    let r2 = test_unix_construction();
    if r2 != 0 { return r2; }
    
    let r3 = test_parse_duration_basic();
    if r3 != 0 { return r3; }
    
    let r4 = test_duration_constants();
    if r4 != 0 { return r4; }
    
    let r5 = test_arithmetic();
    if r5 != 0 { return r5; }
    
    let r6 = test_since_until();
    if r6 != 0 { return r6; }
    
    let r7 = test_rfc3339_parse();
    if r7 != 0 { return r7; }
    
    let r8 = test_zones();
    if r8 != 0 { return r8; }
    
    let r9 = test_date_components();
    if r9 != 0 { return r9; }
    
    let r10 = test_clock_components();
    if r10 != 0 { return r10; }
    
    let r11 = test_weekday_yearday();
    if r11 != 0 { return r11; }
    
    let r12 = test_comparisons();
    if r12 != 0 { return r12; }
    
    let r13 = test_truncate_round();
    if r13 != 0 { return r13; }
    
    let r14 = test_unix_helpers();
    if r14 != 0 { return r14; }
    
    println("");
    println("✅ All 14 tests PASSED!");
    return 0;
}
