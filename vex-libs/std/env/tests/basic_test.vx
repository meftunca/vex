// Environment Module Tests
// Tests for environment variable operations

import { get, set, unset } from "../src/lib.vx";
import { println } from "io";

fn test_basic_env_operations(): i32 {
    // Test set and get
    let test_key: String = "VEX_TEST_VAR";
    let test_value: String = "test_value_123";
    
    // Set environment variable
    let set_ok: bool = set(test_key, test_value);
    if !set_ok {
        println("FAIL: set() returned false");
        return 1; // Set failed
    }
    
    // Get value (use a new string since test_key was moved)
    let retrieved: String = get("VEX_TEST_VAR");
    if retrieved != "test_value_123" {
        println("FAIL: get() returned wrong value");
        return 3; // Value mismatch
    }
    
    // Unset (use a new string since test_key was moved)
    let unset_ok: bool = unset("VEX_TEST_VAR");
    if !unset_ok {
        println("FAIL: unset() returned false");
        return 4; // Unset failed
    }
    
    return 0; // Success
}

fn test_system_env_vars(): i32 {
    // Test that we can get system environment variables
    
    // PATH should exist
    let path_val: String = get("PATH");
    if path_val == "" {
        println("FAIL: PATH is empty");
        return 2; // PATH should not be empty
    }
    
    println("PASS: Got PATH value");
    return 0;
}

fn main(): i32 {
    println("=== Environment Module Test ===");
    
    // Test 1: Basic operations
    let result1: i32 = test_basic_env_operations();
    if result1 != 0 {
        println("FAIL: test_basic_env_operations");
        return result1;
    }
    println("✓ Basic env operations working");
    
    // Test 2: System environment variables
    let result2: i32 = test_system_env_vars();
    if result2 != 0 {
        println("FAIL: test_system_env_vars");
        return result2;
    }
    println("✓ System env vars accessible");
    
    println("✓ Env module fully working");
    return 0;
}
